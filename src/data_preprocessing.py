"""
Модуль для предобработки текстовых данных
"""

import os
import pandas as pd
import re


class DataPreprocessor:
    def __init__(self, config):
        self.config = config
        self.stop_words = self._load_stop_words()
    
    def _load_stop_words(self):
        """Загрузка стоп-слов русского языка"""
        basic_stop_words = {
            'и', 'в', 'во', 'не', 'что', 'он', 'на', 'я', 'с', 'со', 'как', 'а',
            'то', 'все', 'она', 'так', 'его', 'но', 'да', 'ты', 'к', 'у', 'же',
            'вы', 'за', 'бы', 'по', 'только', 'ее', 'мне', 'было', 'вот', 'от',
            'меня', 'еще', 'нет', 'о', 'из', 'ему', 'теперь', 'когда', 'даже',
            'ну', 'вдруг', 'ли', 'если', 'уже', 'или', 'ни', 'быть', 'был',
            'него', 'до', 'вас', 'нибудь', 'опять', 'уж', 'вам', 'ведь',
            'там', 'потом', 'себя', 'ничего', 'ей', 'может', 'они', 'тут',
            'где', 'есть', 'надо', 'ней', 'для', 'мы', 'тебя', 'их', 'чем',
            'была', 'сам', 'чтоб', 'без', 'будто', 'чего', 'раз', 'тоже',
            'себе', 'под', 'будет', 'ж', 'тогда', 'кто', 'этот', 'того',
            'потому', 'этого', 'какой', 'совсем', 'ним', 'здесь', 'этом',
            'один', 'почти', 'мой', 'тем', 'чтобы', 'неё', 'сейчас', 'были',
            'куда', 'зачем', 'всех', 'никогда', 'можно', 'при', 'наконец',
            'два', 'об', 'другой', 'хоть', 'после', 'над', 'больше', 'тот',
            'через', 'эти', 'нас', 'про', 'всего', 'них', 'какая', 'много',
            'разве', 'три', 'эту', 'моя', 'впрочем', 'хорошо', 'свою', 'этой',
            'перед', 'иногда', 'лучше', 'чуть', 'том', 'нельзя', 'такой',
            'им', 'более', 'всегда', 'конечно', 'всю', 'между'
        }
        return basic_stop_words
    
    def clean_text(self, text):
        """Очистка текста от HTML-тегов, пунктуации, цифр"""
        if not isinstance(text, str):
            return ""
        # Удаление HTML-тегов
        text = re.sub(r'<[^>]+>', '', text)
        # Удаление цифр
        text = re.sub(r'\d+', '', text)
        # Удаление пунктуации и специальных символов
        text = re.sub(r'[^\w\s]', ' ', text)
        # Удаление лишних пробелов
        text = re.sub(r'\s+', ' ', text).strip()
        return text
    
    def process_all_corpora(self):
        """Обработка всех корпусов"""
        print("Модуль предобработки загружен успешно!")
        print("Конфигурация:", self.config['preprocessing']['pipelines'].keys())
        return True


def test_preprocessor():
    """Тестовая функция для проверки модуля"""
    test_config = {
        'preprocessing': {
            'pipelines': {
                'P0': ['clean_text', 'lowercase'],
                'P1': ['clean_text', 'lowercase', 'remove_stopwords']
            }
        }
    }
    processor = DataPreprocessor(test_config)
    result = processor.process_all_corpora()
    print("Тест завершен успешно!" if result else "Тест не пройден")


if __name__ == "__main__":
    test_preprocessor()